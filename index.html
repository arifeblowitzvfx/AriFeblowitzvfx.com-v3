<script>
  (function sysDotEffects(){
    const dot = document.querySelector('.brand .dot');
    if (!dot) return;

    // helper to (re)play a CSS keyframe reliably
    function replay(name, ms){
      dot.style.animation = 'none';
      void dot.offsetWidth; // reflow to restart
      dot.style.animation = `${name} ${ms}ms linear 1`;
    }

    const isInteractive = el => el && el.closest && el.closest('a, button, .tab-btn, .tile, .btn');

    // subtle hover flicker stays as before
    function onHover(){ replay('dotFlick', 950); }
    document.addEventListener('mouseover', e=>{ if (isInteractive(e.target)) onHover(); }, {passive:true});
    document.addEventListener('focusin',   e=>{ if (isInteractive(e.target)) onHover(); });

    // CLICK → force 1s yellow flicker, overriding green glow
    function onClick(){
      if (!document.body.classList.contains('ready')) return;

      // apply yellow via inline styles so it always wins the cascade
      const prevBG   = dot.style.background;
      const prevBox  = dot.style.boxShadow;
      const prevAnim = dot.style.animation;

      dot.style.setProperty('background','radial-gradient(circle at 30% 30%, #ffd24a, #6b5a1a 70%)','important');
      dot.style.setProperty('box-shadow','0 0 22px #ffd24a, 0 0 36px rgba(255,210,74,.5)','important');

      // play the alert keyframe for ~1s
      replay('alertFlick', 1000);

      // cleanly restore green state after 1s
      setTimeout(()=>{
        dot.style.background = prevBG;
        dot.style.boxShadow  = prevBox;
        dot.style.animation  = prevAnim || '';
      }, 1000);
    }

    document.addEventListener('pointerdown', e=>{ if (isInteractive(e.target)) onClick(); }, {passive:true});
    document.addEventListener('keydown', e=>{ if ((e.key==='Enter'||e.key===' ') && isInteractive(e.target)) onClick(); });

    // keep the contact “extras” injection exactly as before
    function tryInject(){
      const wrap = document.getElementById('contactInfo');
      const links = document.getElementById('btnLinks');
      const resume = document.getElementById('btnResume');
      if (!wrap || !links) return false;
      if (!wrap.querySelector('[data-extra="links"]')){
        const a = document.createElement('a');
        a.className='btn'; a.href=links.href; a.target='_blank'; a.rel='noopener';
        a.textContent='All My Links'; a.setAttribute('data-extra','links'); wrap.appendChild(a);
      }
      if (resume && resume.href && !wrap.querySelector('[data-extra="resume"]')){
        const a = document.createElement('a');
        a.className='btn'; a.href=resume.href; a.download='';
        a.textContent='Download Résumé'; a.setAttribute('data-extra','resume'); wrap.appendChild(a);
      }
      return true;
    }
    let tries = 0; const timer = setInterval(()=>{ if (tryInject() || ++tries>20) clearInterval(timer); }, 250);
  })();
</script>
